variables:
- group: devgrp
- name: COMMIT
  value: $(Build.SourceVersion)$(Build.BuildNumber)
- name: SERVICE_NAME
  value: facebookservice
- name: pathToCache
  value: $(Pipeline.Workspace)/.m2/repository
- name: cacheKey
  value: maven | "$(Agent.OS)" | **/pom.xml
- name: restoreKeys
  value: ' | maven | "$(Agent.OS)" maven '
- name: PMD_ANALYSIS_SKIP
  value: false
- name: JUNIT_TESTS_ANALYSIS_SKIP
  value: false
- name: BUILD_QUALITYCHECK
  value: false
- name: SONAR_ANALYSIS
  value: true
resources:
  repositories:
  - repository: self
    type: git
    ref: azure-pipelines
name: $(date:yyyyMMdd)$(rev:.r)
trigger: none
pr: none
pool:
  name: kubernetes
stages:
- stage: build_and_test
  displayName: Build and test
  dependsOn: null
  condition: and(not(failed()), in(variables['Build.Reason'], 'IndividualCI', 'Manual'))
  variables:
  - name: ENV
    value: dev
  - name: CONFIG_REPO_PATH
    value: dev

- stage: deploy_dev
  displayName: Deploy to Dev
  dependsOn: build_and_test
  condition: and(not(failed()), in(variables['Build.Reason'], 'IndividualCI', 'Manual'))
  variables:
  - name: ENV
    value: dev
